<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ø®ØªØ¨Ø§Ø± Chat Socket</title>
  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
</head>
<body>
  <h1>Ø§Ø®ØªØ¨Ø§Ø± Chat Socket</h1>

  <label>User ID: <input type="number" id="userId" value="10000"></label>
  <button id="connectBtn">Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</button>
  <hr>

  <div>
    <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
    <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>

  <h3>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:</h3>
  <ul id="messagesList"></ul>

  <script>
    let socket;
    const connectBtn = document.getElementById("connectBtn");
    const sendBtn = document.getElementById("sendBtn");
    const messageInput = document.getElementById("messageInput");
    const messagesList = document.getElementById("messagesList");

    connectBtn.onclick = () => {
      const userId = document.getElementById("userId").value;
      socket = io("https://fils.khaleeafashion.com", {
        transports: ["websocket"],
        query: { userId }
      });

      socket.on("connect", () => {
        console.log("âœ… Connected to server");
        appendMessage("âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");

        // Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        socket.emit("getMessages", { userId, receiverId: null });
      });

      socket.on("messagesLoaded", (messages) => {
        console.log("ğŸ“¥ Messages:", messages);
        messagesList.innerHTML = "";
        messages.forEach(msg => appendMessage(`ğŸŸ¢ ${msg.sender?.name || msg.senderId}: ${msg.message}`));
      });

      socket.on("newMessage", (msg) => {
        console.log("ğŸ“© New message:", msg);
        appendMessage(`ğŸ“© ${msg.sender?.name || msg.senderId}: ${msg.message}`);
      });

      socket.on("disconnect", () => appendMessage("âŒ Disconnected"));
      socket.on("connect_error", (err) => appendMessage(`âŒ Connect error: ${err}`));
    };

    sendBtn.onclick = () => {
      const text = messageInput.value.trim();
      if (!text) return;
      const userId = document.getElementById("userId").value;
      socket.emit("sendMessage", { senderId: parseInt(userId), receiverId: null, message: text });
      messageInput.value = "";
    };

    function appendMessage(msg) {
      const li = document.createElement("li");
      li.textContent = msg;
      messagesList.appendChild(li);
    }
  </script>
</body>
</html>
