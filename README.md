# نظام غرف الدردشة الجماعية

نظام دردشة جماعية في الوقت الفعلي باستخدام Socket.IO و Express.js

## المميزات

- ✅ إنشاء غرف دردشة جماعية
- ✅ خصم النقاط من منشئ الغرفة
- ✅ عرض الغرف المتوفرة
- ✅ الانضمام للغرف والدردشة في الوقت الفعلي
- ✅ إدارة المستخدمين في الغرف
- ✅ مؤشر الكتابة
- ✅ واجهة مستخدم جميلة وسهلة الاستخدام
- ✅ بنية كود منظمة ومنفصلة

## التثبيت والتشغيل

### 1. تثبيت المكتبات المطلوبة
```bash
npm install
```

### 2. تشغيل الخادم
```bash
node server.js
```

الخادم سيعمل على المنفذ 1300

### 3. الوصول للواجهة
افتح المتصفح واذهب إلى: `http://localhost:1300`

## هيكل المشروع

```
├── server.js              # الملف الرئيسي للخادم
├── socket/
│   └── socketHandler.js   # منطق Socket.IO منفصل
├── models/
│   ├── room.js           # نموذج الغرف
│   ├── message.js        # نموذج الرسائل
│   └── user.js           # نموذج المستخدمين
├── routes/
│   └── rooms.js          # راوتر الغرف
├── public/
│   └── index.html        # واجهة المستخدم
└── README.md
```

## API Endpoints

### إنشاء غرفة جديدة
```
POST /create-room
Headers: Authorization: Bearer <token>
Body: {
    "name": "اسم الغرفة",
    "description": "وصف الغرفة",
    "cost": 100,
    "maxUsers": 50,
    "category": "general"
}
```

### عرض الغرف المتوفرة
```
GET /rooms?category=general&page=1&limit=10
Headers: Authorization: Bearer <token>
```

### تفاصيل غرفة معينة
```
GET /room/:roomId
Headers: Authorization: Bearer <token>
```

### رسائل غرفة معينة
```
GET /room/:roomId/messages?page=1&limit=50
Headers: Authorization: Bearer <token>
```

### حذف غرفة (للمنشئ فقط)
```
DELETE /room/:roomId
Headers: Authorization: Bearer <token>
```

## Socket.IO Events

### Client to Server
- `join-room` - الانضمام إلى غرفة
- `send-message` - إرسال رسالة
- `leave-room` - مغادرة الغرفة
- `typing` - مؤشر الكتابة

### Server to Client
- `joined-room` - تأكيد الانضمام للغرفة
- `user-joined` - إشعار بانضمام مستخدم جديد
- `user-left` - إشعار بمغادرة مستخدم
- `new-message` - رسالة جديدة
- `room-users` - قائمة المستخدمين في الغرفة
- `user-typing` - مؤشر الكتابة
- `error` - رسالة خطأ

## قاعدة البيانات

### جدول Rooms
- `id` - معرف الغرفة
- `name` - اسم الغرفة
- `description` - وصف الغرفة
- `creatorId` - معرف منشئ الغرفة
- `cost` - تكلفة إنشاء الغرفة
- `maxUsers` - الحد الأقصى للمستخدمين
- `currentUsers` - عدد المستخدمين الحاليين
- `isActive` - حالة الغرفة
- `category` - فئة الغرفة

### جدول Messages
- `id` - معرف الرسالة
- `roomId` - معرف الغرفة
- `userId` - معرف المستخدم
- `content` - محتوى الرسالة
- `messageType` - نوع الرسالة (text, image, file)
- `isDeleted` - حالة الحذف

## كيفية الاستخدام

1. **الحصول على Token**: احصل على token المستخدم من نظام تسجيل الدخول
2. **إنشاء غرفة**: أدخل بيانات الغرفة واضغط "إنشاء غرفة جديدة"
3. **الانضمام للغرفة**: اختر غرفة من القائمة للانضمام إليها
4. **الدردشة**: اكتب رسالتك واضغط إرسال أو Enter
5. **مغادرة الغرفة**: اضغط "مغادرة الغرفة" للخروج

## ملاحظات مهمة

- يجب أن يكون لدى المستخدم نقاط كافية لإنشاء الغرفة
- يتم خصم النقاط تلقائياً عند إنشاء الغرفة
- يمكن للمنشئ فقط حذف الغرفة
- الرسائل تُحفظ في قاعدة البيانات
- النظام يدعم الدردشة في الوقت الفعلي
- منطق Socket.IO منفصل في ملف خاص للتنظيم

## الأمان

- جميع الطلبات تتطلب مصادقة باستخدام JWT
- التحقق من صلاحيات المستخدم
- حماية من XSS و CSRF
- التحقق من صحة البيانات المدخلة
